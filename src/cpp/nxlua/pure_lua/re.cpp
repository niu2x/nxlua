#include "re.h"
#include "niu2x/pipe.h"

static const uint8_t luacode_bytearray[] = { 120, 156, 149, 25, 107, 111, 219,
    200, 241, 187, 126, 197, 118, 239, 82, 146, 22, 165, 88, 46, 250, 161, 78,
    148, 226, 224, 4, 65, 128, 131, 107, 196, 87, 183, 168, 107, 11, 20, 185,
    164, 23, 33, 151, 12, 31, 126, 156, 99, 255, 246, 206, 204, 238, 114, 73,
    74, 118, 113, 70, 32, 145, 59, 239, 247, 172, 178, 88, 176, 159, 191, 36,
    199, 172, 22, 203, 188, 139, 216, 207, 179, 217, 98, 193, 100, 81, 149, 117,
    43, 18, 150, 118, 42, 110, 101, 169, 26, 22, 169, 132, 21, 101, 210, 229,
    162, 153, 229, 101, 28, 229, 172, 45, 85, 87, 108, 69, 29, 178, 246, 161,
    18, 33, 171, 106, 169, 218, 144, 137, 186, 46, 107, 182, 126, 21, 108, 56,
    52, 162, 45, 68, 27, 181, 209, 54, 23, 64, 49, 124, 53, 24, 5, 28, 215, 226,
    123, 39, 107, 193, 243, 74, 100, 156, 212, 243, 10, 143, 221, 201, 60, 103,
    91, 193, 186, 6, 212, 108, 75, 86, 69, 117, 35, 152, 184, 175, 106, 209, 52,
    168, 113, 72, 42, 123, 197, 46, 46, 178, 136, 107, 17, 181, 35, 252, 119,
    172, 189, 137, 90, 38, 129, 208, 171, 133, 199, 234, 14, 172, 46, 21, 10,
    11, 53, 186, 84, 25, 136, 105, 91, 81, 171, 6, 121, 16, 176, 240, 172, 170,
    168, 107, 65, 250, 25, 36, 175, 97, 59, 246, 180, 128, 148, 13, 236, 244,
    139, 98, 121, 230, 31, 6, 193, 108, 70, 164, 167, 37, 120, 185, 22, 44, 203,
    203, 45, 224, 71, 113, 12, 234, 9, 112, 127, 10, 28, 65, 67, 217, 176, 170,
    4, 71, 26, 126, 183, 162, 70, 229, 129, 233, 230, 226, 211, 215, 243, 47,
    255, 56, 157, 201, 212, 157, 174, 25, 255, 21, 130, 250, 215, 229, 17, 7,
    90, 161, 216, 230, 211, 233, 5, 32, 43, 153, 51, 161, 18, 16, 169, 217, 68,
    234, 1, 149, 7, 77, 86, 129, 214, 227, 172, 22, 139, 68, 164, 82, 129, 199,
    84, 84, 244, 65, 135, 115, 56, 6, 228, 71, 166, 114, 77, 195, 255, 171, 56,
    123, 234, 121, 21, 162, 48, 79, 169, 123, 204, 240, 209, 98, 216, 164, 98,
    93, 149, 64, 16, 232, 80, 48, 63, 152, 49, 112, 226, 82, 191, 250, 90, 16,
    158, 233, 167, 101, 4, 210, 236, 99, 94, 221, 68, 14, 18, 59, 72, 172, 218,
    58, 119, 144, 196, 65, 18, 153, 201, 214, 65, 50, 7, 201, 234, 168, 186,
    113, 144, 220, 65, 242, 242, 78, 212, 14, 82, 57, 72, 133, 38, 56, 72, 227,
    32, 77, 21, 197, 194, 65, 58, 7, 233, 170, 106, 200, 237, 110, 104, 15, 148,
    138, 131, 220, 59, 200, 253, 68, 237, 95, 0, 132, 193, 90, 244, 164, 14,
    118, 50, 133, 197, 14, 246, 113, 10, 75, 28, 236, 243, 20, 150, 57, 216,
    175, 83, 216, 192, 185, 103, 83, 88, 229, 96, 231, 83, 88, 227, 96, 255,
    156, 194, 58, 7, 251, 215, 20, 118, 231, 96, 255, 158, 194, 238, 49, 97, 4,
    150, 221, 227, 19, 131, 63, 72, 91, 40, 230, 54, 170, 91, 60, 46, 229, 239,
    17, 102, 25, 32, 165, 22, 11, 158, 179, 193, 243, 160, 38, 31, 55, 27, 232,
    110, 216, 133, 248, 45, 71, 88, 51, 42, 82, 81, 132, 128, 23, 76, 207, 211,
    151, 0, 89, 15, 208, 101, 54, 204, 116, 159, 106, 93, 203, 254, 98, 202,
    174, 47, 9, 191, 9, 101, 160, 123, 165, 47, 67, 214, 28, 55, 221, 214, 95,
    133, 76, 46, 86, 65, 240, 14, 236, 107, 187, 90, 49, 137, 213, 27, 236, 22,
    20, 54, 158, 141, 110, 192, 192, 136, 201, 192, 25, 217, 96, 198, 251, 63,
    53, 236, 61, 80, 207, 217, 209, 97, 64, 253, 81, 11, 32, 196, 87, 254, 128,
    159, 65, 12, 229, 28, 73, 151, 75, 198, 151, 203, 37, 199, 8, 104, 206, 220,
    52, 61, 211, 255, 149, 136, 106, 230, 189, 105, 60, 30, 28, 167, 101, 93,
    68, 173, 15, 136, 40, 134, 224, 248, 18, 178, 35, 227, 158, 137, 21, 69,
    151, 183, 204, 175, 66, 166, 156, 254, 10, 139, 143, 122, 101, 91, 119, 2,
    207, 239, 110, 36, 116, 13, 197, 62, 172, 217, 138, 37, 37, 25, 0, 189, 79,
    189, 57, 210, 71, 212, 239, 136, 12, 62, 14, 88, 69, 13, 15, 145, 240, 136,
    78, 232, 13, 123, 167, 122, 123, 132, 138, 17, 220, 120, 88, 85, 123, 85,
    131, 81, 20, 229, 113, 84, 105, 247, 194, 92, 64, 77, 64, 42, 142, 56, 63,
    14, 216, 51, 228, 79, 211, 66, 244, 50, 211, 112, 45, 59, 211, 112, 173, 57,
    152, 104, 63, 197, 16, 7, 169, 233, 173, 119, 1, 176, 96, 171, 0, 59, 119,
    60, 98, 0, 163, 42, 135, 249, 54, 97, 55, 236, 225, 88, 114, 254, 176, 9, 1,
    119, 190, 88, 112, 176, 212, 31, 149, 141, 202, 131, 235, 67, 248, 103, 9,
    177, 189, 83, 26, 126, 245, 249, 47, 255, 225, 33, 227, 209, 239, 248, 185,
    217, 240, 0, 136, 247, 157, 195, 231, 225, 223, 248, 128, 71, 4, 65, 197,
    134, 118, 14, 4, 252, 253, 130, 207, 250, 9, 255, 125, 147, 150, 121, 78,
    64, 156, 21, 111, 57, 170, 21, 208, 231, 19, 125, 30, 235, 175, 103, 253,
    245, 131, 190, 124, 210, 233, 64, 179, 13, 224, 96, 177, 154, 205, 122, 61,
    79, 8, 108, 6, 85, 196, 134, 99, 10, 102, 114, 254, 192, 110, 162, 91, 1,
    45, 32, 82, 56, 177, 165, 2, 156, 76, 222, 130, 47, 133, 186, 149, 117, 169,
    10, 209, 207, 207, 143, 52, 203, 140, 52, 224, 28, 213, 153, 30, 129, 147,
    184, 195, 200, 198, 177, 231, 203, 36, 68, 121, 141, 75, 76, 28, 62, 120,
    66, 213, 132, 15, 151, 50, 185, 210, 65, 85, 101, 107, 163, 168, 147, 158,
    119, 106, 168, 236, 49, 227, 88, 72, 50, 9, 198, 185, 23, 235, 184, 130,
    113, 80, 54, 241, 13, 168, 79, 10, 162, 0, 131, 1, 6, 213, 101, 87, 177, 50,
    101, 178, 109, 88, 92, 214, 208, 248, 170, 82, 37, 104, 48, 137, 144, 212,
    250, 208, 63, 184, 4, 165, 30, 243, 97, 71, 130, 21, 8, 130, 145, 128, 120,
    112, 138, 119, 222, 165, 169, 188, 247, 130, 169, 173, 64, 127, 39, 219, 27,
    124, 103, 62, 77, 96, 35, 21, 252, 147, 249, 232, 177, 183, 214, 31, 228,
    179, 24, 144, 130, 81, 42, 194, 52, 51, 129, 130, 228, 193, 76, 185, 94, 97,
    38, 157, 3, 161, 221, 10, 251, 172, 165, 98, 193, 182, 235, 113, 205, 206,
    55, 217, 10, 7, 152, 167, 152, 80, 0, 154, 79, 27, 148, 199, 189, 49, 62,
    28, 24, 124, 120, 234, 85, 177, 254, 6, 1, 111, 80, 128, 86, 223, 181, 219,
    56, 252, 56, 14, 103, 132, 211, 0, 209, 116, 68, 241, 225, 50, 190, 194, 14,
    168, 203, 7, 94, 6, 209, 5, 108, 23, 95, 104, 130, 20, 40, 143, 194, 26, 83,
    147, 244, 88, 31, 115, 62, 13, 115, 212, 14, 123, 204, 215, 72, 101, 38,
    191, 27, 50, 9, 234, 22, 43, 102, 1, 53, 67, 133, 104, 253, 114, 197, 131,
    0, 108, 128, 102, 248, 213, 210, 202, 150, 134, 154, 111, 173, 157, 27, 110,
    115, 114, 16, 208, 105, 138, 229, 153, 37, 56, 201, 163, 6, 150, 22, 114,
    42, 191, 196, 54, 78, 210, 78, 72, 226, 53, 191, 198, 105, 99, 70, 106, 89,
    161, 167, 208, 53, 101, 81, 229, 2, 139, 135, 53, 15, 197, 182, 204, 137,
    10, 136, 82, 159, 228, 3, 7, 250, 214, 42, 94, 31, 226, 252, 91, 110, 54,
    81, 2, 249, 253, 246, 149, 249, 50, 12, 6, 171, 130, 222, 61, 180, 190, 94,
    115, 10, 131, 54, 189, 194, 48, 216, 70, 126, 128, 98, 118, 10, 21, 164, 81,
    161, 194, 77, 227, 91, 136, 235, 189, 109, 208, 151, 223, 174, 40, 84, 164,
    136, 41, 71, 15, 102, 216, 55, 152, 98, 30, 139, 114, 88, 240, 147, 135, 62,
    93, 34, 136, 62, 220, 0, 114, 193, 105, 100, 65, 235, 37, 58, 226, 178, 70,
    182, 211, 121, 209, 238, 29, 23, 169, 172, 27, 221, 56, 84, 200, 234, 222,
    52, 173, 164, 255, 168, 158, 96, 198, 17, 96, 88, 61, 61, 245, 233, 111, 68,
    183, 13, 92, 194, 109, 119, 108, 64, 37, 25, 26, 162, 200, 16, 186, 226,
    148, 93, 219, 72, 88, 102, 176, 77, 68, 69, 17, 213, 189, 21, 125, 41, 23,
    203, 11, 159, 198, 235, 116, 140, 128, 109, 186, 85, 63, 50, 254, 233, 190,
    226, 33, 224, 124, 162, 51, 236, 237, 62, 64, 46, 248, 103, 195, 117, 20,
    212, 185, 78, 5, 132, 159, 139, 239, 52, 118, 176, 219, 31, 16, 157, 61,
    157, 164, 69, 240, 14, 88, 192, 185, 78, 123, 36, 134, 110, 130, 41, 104,
    38, 207, 5, 135, 162, 131, 38, 197, 175, 15, 153, 161, 131, 229, 192, 45,
    43, 7, 184, 209, 184, 17, 51, 31, 44, 64, 196, 90, 83, 99, 241, 255, 121,
    168, 137, 97, 138, 37, 129, 44, 115, 227, 81, 99, 6, 255, 211, 43, 184, 157,
    42, 102, 35, 147, 193, 46, 234, 163, 156, 76, 161, 71, 103, 13, 146, 75,
    240, 212, 131, 225, 56, 112, 152, 79, 190, 60, 227, 115, 110, 187, 232, 202,
    88, 88, 193, 200, 219, 241, 236, 25, 63, 232, 17, 15, 95, 71, 252, 123, 143,
    184, 120, 133, 37, 86, 150, 142, 39, 52, 117, 108, 216, 134, 6, 151, 175,
    96, 255, 58, 56, 215, 200, 186, 77, 156, 243, 249, 66, 11, 26, 116, 120,
    205, 193, 74, 220, 207, 101, 71, 145, 197, 7, 235, 111, 163, 141, 111, 134,
    194, 28, 7, 201, 152, 109, 34, 111, 95, 96, 59, 112, 192, 227, 83, 239, 1,
    88, 148, 66, 124, 106, 95, 37, 26, 76, 60, 39, 230, 101, 130, 29, 11, 214,
    189, 5, 35, 78, 203, 147, 162, 221, 193, 125, 126, 9, 55, 29, 163, 210, 192,
    28, 156, 80, 229, 184, 86, 25, 133, 219, 48, 237, 27, 74, 138, 239, 212, 69,
    152, 201, 123, 202, 58, 76, 124, 159, 155, 68, 198, 98, 198, 166, 25, 76,
    203, 214, 120, 155, 38, 202, 217, 4, 70, 115, 98, 114, 102, 122, 228, 212,
    176, 199, 99, 74, 40, 179, 75, 241, 99, 174, 243, 133, 98, 16, 4, 19, 37,
    112, 233, 123, 97, 38, 56, 27, 213, 112, 28, 20, 148, 26, 116, 41, 232, 55,
    249, 97, 8, 144, 45, 201, 30, 78, 119, 53, 34, 47, 90, 252, 181, 229, 100,
    11, 199, 97, 191, 201, 239, 227, 102, 147, 136, 92, 114, 82, 237, 88, 250,
    60, 245, 233, 115, 143, 60, 117, 22, 127, 252, 49, 69, 254, 209, 35, 183,
    59, 200, 83, 220, 30, 117, 143, 134, 203, 62, 203, 113, 192, 79, 16, 108,
    28, 22, 122, 51, 7, 222, 239, 123, 15, 1, 223, 15, 166, 193, 130, 51, 248,
    103, 142, 203, 193, 233, 111, 152, 56, 31, 251, 221, 209, 173, 197, 154,
    131, 211, 11, 241, 204, 4, 208, 157, 46, 211, 125, 155, 46, 102, 112, 51,
    64, 126, 7, 35, 117, 250, 110, 232, 216, 163, 93, 253, 116, 60, 176, 92, 70,
    24, 152, 241, 147, 20, 209, 131, 51, 176, 185, 250, 100, 135, 150, 189, 123,
    174, 77, 219, 182, 42, 165, 17, 204, 188, 94, 39, 154, 109, 154, 20, 51,
    117, 129, 75, 197, 104, 100, 236, 142, 96, 220, 121, 240, 154, 137, 137,
    103, 247, 126, 24, 197, 192, 130, 110, 124, 21, 221, 212, 236, 213, 119,
    124, 229, 163, 61, 133, 209, 10, 101, 183, 11, 195, 205, 93, 3, 99, 186,
    139, 106, 234, 99, 90, 246, 81, 208, 106, 36, 139, 246, 204, 106, 116, 141,
    144, 138, 54, 254, 184, 181, 180, 112, 33, 251, 203, 116, 187, 220, 127,
    129, 213, 55, 10, 188, 189, 86, 163, 223, 7, 72, 147, 66, 20, 151, 213, 213,
    142, 88, 10, 2, 33, 24, 3, 252, 74, 167, 155, 198, 199, 243, 157, 125, 40,
    174, 140, 61, 120, 79, 198, 181, 109, 181, 255, 174, 15, 209, 78, 94, 82,
    39, 253, 3, 250, 64, 92, 15, 221, 121, 65, 251, 11, 21, 175, 143, 129, 143,
    241, 190, 111, 95, 231, 108, 165, 223, 46, 224, 170, 199, 158, 136, 42, 221,
    103, 138, 217, 173, 67, 186, 173, 239, 51, 136, 20, 147, 163, 168, 219, 43,
    252, 100, 223, 146, 195, 77, 107, 122, 183, 132, 171, 191, 117, 65, 45, 42,
    231, 4, 188, 22, 101, 70, 49, 16, 72, 63, 114, 65, 54, 9, 213, 116, 248, 11,
    177, 129, 200, 70, 251, 6, 86, 32, 200, 8, 216, 254, 244, 15, 35, 55, 162,
    22, 230, 231, 46, 109, 88, 54, 118, 110, 118, 9, 178, 254, 64, 172, 173, 95,
    225, 114, 226, 199, 88, 70, 64, 142, 174, 196, 59, 23, 33, 104, 134, 255,
    39, 25, 236, 61, 17, 205, 184, 55, 255, 199, 48, 252, 121, 185, 70, 87, 63,
    2, 165, 45, 188, 94, 15, 108, 5, 58, 121, 215, 250, 27, 15, 40, 123, 214,
    244, 133, 175, 228, 201, 53, 125, 225, 235, 232, 231, 229, 245, 232, 53,
    196, 222, 177, 247, 151, 242, 149, 253, 165, 252, 243, 146, 148, 129, 15,
    82, 217, 152, 2, 78, 253, 31, 255, 237, 21, 253 };

#include <iostream>
#include <sstream>

void pure_lua_re_open(lua_State* L)
{

    std::string luacode(
        luacode_bytearray, luacode_bytearray + sizeof(luacode_bytearray));
    std::istringstream is(luacode);
    nx::pipe::source_t source(is);

    std::stringstream out;
    nx::pipe::sink_t sink(out);

    nx::pipe::filter::unzlib_t unzlib;

    source | unzlib | sink;

    if (luaL_dostring(L, out.str().c_str())) {
        std::cerr << lua_tostring(L, -1) << std::endl;
    }
}